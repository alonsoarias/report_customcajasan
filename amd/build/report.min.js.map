{"version":3,"file":"report.min.js","sources":["../src/report.js"],"sourcesContent":["/**\n * JavaScript for the report_customcajasan report\n *\n * @module     block_report_customcajasan/report\n * @copyright  2025 Cajasan\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/notification', 'core/str'], function($, Notification, Str) {\n    // Store the current page number\n    var currentPage = 0;\n\n    /**\n     * Load report data via AJAX\n     */\n    function loadReportData() {\n        // Show loading indicator\n        $('#report-results').addClass('loading');\n\n        // Get filter values\n        var formData = $('#report-form').serialize();\n        formData += '&page=' + currentPage;\n        formData += '&sesskey=' + M.cfg.sesskey;\n\n        // Make AJAX request\n        $.ajax({\n            url: M.cfg.wwwroot + '/blocks/report_customcajasan/ajax/get_report_data.php',\n            type: 'GET',\n            data: formData,\n            dataType: 'json',\n            success: function(response) {\n                if (response && response.success) {\n                    // Update report content\n                    $('#report-results').html(response.html);\n\n                    // Re-initialize pagination and other dynamic elements\n                    initializeDynamicElements();\n\n                    // Colorize status cells\n                    colorizeStatusCells();\n                } else {\n                    // Show error using Moodle's notification API instead of console\n                    Str.get_string('ajax_error', 'block_report_customcajasan')\n                        .then(function(errorString) {\n                            $('#report-results').html(\n                                '<div class=\"alert alert-danger\">' + errorString + '</div>'\n                            );\n                            return;\n                        })\n                        .catch(Notification.exception);\n                }\n            },\n            error: function(xhr, status, error) {\n                // Show error using Moodle's notification API instead of console\n                Str.get_string('ajax_error_detail', 'block_report_customcajasan')\n                    .then(function(errorString) {\n                        $('#report-results').html(\n                            '<div class=\"alert alert-danger\">' + errorString + ': ' + status + '</div>'\n                        );\n                        return;\n                    })\n                    .catch(Notification.exception);\n            },\n            complete: function() {\n                // Hide loading indicator\n                $('#report-results').removeClass('loading');\n            }\n        });\n    }\n\n    /**\n     * Initialize dynamic elements like pagination\n     */\n    function initializeDynamicElements() {\n        // Handle pagination clicks\n        $('.pagination .page-link').on('click', function(e) {\n            e.preventDefault();\n            var page = $(this).data('page');\n\n            if (page !== undefined) {\n                currentPage = page;\n                loadReportData();\n            }\n        });\n    }\n\n    /**\n     * Apply colors to status cells based on status values\n     */\n    function colorizeStatusCells() {\n        // Status cells are at column index 9 (0-based)\n        $('#enrollment-report-table tbody tr').each(function() {\n            var statusCell = $(this).find('td:eq(9)'); // Estado is at column 9\n            var statusText = statusCell.text().trim();\n\n            if (statusText === 'COMPLETO') {\n                statusCell.addClass('bg-success text-white');\n            } else if (statusText === 'EN PROGRESO') {\n                statusCell.addClass('bg-warning');\n            } else if (statusText === 'FINALIZADO') {\n                statusCell.addClass('bg-info text-white');\n            } else if (statusText === 'CONSULTA') {\n                statusCell.addClass('bg-secondary text-white');\n            }\n        });\n    }\n\n    /**\n     * Initialize the module\n     */\n    function init() {\n        // Handle category change - update courses\n        $('#categoryid').on('change', function() {\n            var categoryId = $(this).val();\n\n            // Clear course selection\n            $('#courseid').empty();\n            \n            // Obtener el texto de \"Todos\" directamente\n            var allText = M.util.get_string('option_all', 'block_report_customcajasan');\n            $('#courseid').append($('<option>', {\n                value: '',\n                text: allText\n            }));\n\n            if (categoryId) {\n                // Get courses for the selected category\n                $.ajax({\n                    url: M.cfg.wwwroot + '/blocks/report_customcajasan/ajax/get_courses.php',\n                    type: 'GET',\n                    data: {\n                        'categoryid': categoryId,\n                        'sesskey': M.cfg.sesskey\n                    },\n                    dataType: 'json',\n                    success: function(data) {\n                        if (data.success && data.courses) {\n                            $.each(data.courses, function(index, course) {\n                                $('#courseid').append($('<option>', {\n                                    value: course.id,\n                                    text: course.fullname\n                                }));\n                            });\n                        }\n                        // Reset to page 0 and load data\n                        currentPage = 0;\n                        loadReportData();\n                    },\n                    error: function() {\n                        // Show error using Moodle's notification instead of console\n                        Notification.exception({message: 'Error loading courses'});\n                        // Reset to page 0 and load data anyway\n                        currentPage = 0;\n                        loadReportData();\n                    }\n                });\n            } else {\n                // If no category selected, reset to page 0 and load data\n                currentPage = 0;\n                loadReportData();\n            }\n        });\n\n        // Alphabet filter functionality\n        $('.alphabet-filter a').on('click', function(e) {\n            e.preventDefault();\n            var letter = $(this).data('letter');\n            var target = $(this).data('target');\n\n            // Update the hidden input with the selected letter\n            $('#' + target).val(letter);\n\n            // Update the UI to show active letter\n            $(this).closest('.alphabet-filter').find('a').removeClass('active');\n            $(this).addClass('active');\n\n            // Reset to page 0 and load data\n            currentPage = 0;\n            loadReportData();\n        });\n\n        // Handle filter form submission\n        $('#report-form').on('submit', function(e) {\n            e.preventDefault();\n            currentPage = 0;\n            loadReportData();\n        });\n\n        // Handle filter changes\n        $('#estado, #courseid').on('change', function() {\n            currentPage = 0;\n            loadReportData();\n        });\n\n        // Handle date changes\n        $('#startdate, #enddate').on('change', function() {\n            currentPage = 0;\n            loadReportData();\n        });\n\n        // Handle idnumber input with debounce\n        var idnumberTimer;\n        $('#idnumber').on('input', function() {\n            clearTimeout(idnumberTimer);\n            idnumberTimer = setTimeout(function() {\n                currentPage = 0;\n                loadReportData();\n            }, 500); // 500ms delay\n        });\n\n        // Initial load if filters are set\n        if ($('#report-results').length) {\n            var hasFilters = $('#categoryid').val() || $('#courseid').val() || $('#estado').val() ||\n                            $('#idnumber').val() || $('#firstname').val() || $('#lastname').val() ||\n                            $('#startdate').val() || $('#enddate').val();\n\n            if (hasFilters) {\n                loadReportData();\n            }\n        }\n\n        // Initialize any existing dynamic elements\n        initializeDynamicElements();\n    }\n\n    return {\n        init: init\n    };\n});"],"names":["define","$","Notification","Str","currentPage","loadReportData","addClass","formData","serialize","M","cfg","sesskey","ajax","url","wwwroot","type","data","dataType","success","response","html","initializeDynamicElements","each","statusCell","this","find","statusText","text","trim","get_string","then","errorString","catch","exception","error","xhr","status","complete","removeClass","on","e","preventDefault","page","undefined","init","idnumberTimer","categoryId","val","empty","allText","util","append","value","courses","index","course","id","fullname","message","letter","target","closest","clearTimeout","setTimeout","length"],"mappings":"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"}