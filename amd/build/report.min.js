/**
 * JavaScript for the report_customcajasan report
 *
 * @module     block_report_customcajasan/report
 * @copyright  2025 Cajasan
 * @author     Pedro Arias <soporte@ingeweb.co>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_report_customcajasan/report",["jquery","core/notification","core/str"],(function($,Notification,Str){var state={currentPage:0,perPage:100,filter:{}};function updateDownloadForm(){$('#downloadForm input[name="categoryid"]').val($("#categoryid").val()),$('#downloadForm input[name="courseid"]').val($("#courseid").val()),$('#downloadForm input[name="idnumber"]').val($("#idnumber").val()),$('#downloadForm input[name="firstname"]').val($("#firstname").val()),$('#downloadForm input[name="lastname"]').val($("#lastname").val()),$('#downloadForm input[name="estado"]').val($("#estado").val()),$('#downloadForm input[name="startdate"]').val($("#startdate").val()),$('#downloadForm input[name="enddate"]').val($("#enddate").val())}function loadReportData(){$("#report-results").addClass("loading");var formData=$("#report-form").serialize();formData+="&page="+state.currentPage,void 0!==state.perPage&&(formData+="&perpage="+state.perPage),formData+="&sesskey="+M.cfg.sesskey,$.ajax({url:M.cfg.wwwroot+"/blocks/report_customcajasan/ajax/get_report_data.php",type:"GET",data:formData,dataType:"json",success:function(response){if(response&&response.success)$("#report-results").html(response.html),state.totalCount=response.count,initializeDynamicElements(),$("#enrollment-report-table tbody tr").each((function(){var statusCell=$(this).find("td:eq(10)"),statusText=statusCell.text().trim();statusCell.removeClass("bg-success bg-warning bg-info bg-secondary bg-danger text-white"),"APROBADO"===statusText?statusCell.addClass("bg-success text-white"):"EN CURSO"===statusText?statusCell.addClass("bg-warning"):"NO INICIADO"===statusText?statusCell.addClass("bg-danger text-white"):"SOLO CONSULTA"===statusText&&statusCell.addClass("bg-secondary text-white")})),updateDownloadForm();else{var errorMsg=response&&response.error?response.error:M.util.get_string("ajax_error","block_report_customcajasan");$("#report-results").html('<div class="alert alert-danger">'+errorMsg+"</div>")}},error:function(xhr,status){Str.get_string("ajax_error_detail","block_report_customcajasan").then((function(errorString){$("#report-results").html('<div class="alert alert-danger">'+errorString+": "+status+"</div>")})).catch(Notification.exception)},complete:function(){$("#report-results").removeClass("loading")}})}function initializeDynamicElements(){$(document).off("click",".pagination .page-link").on("click",".pagination .page-link",(function(e){e.preventDefault();var page=$(this).data("page");void 0!==page&&(state.currentPage=page,loadReportData(),$("html, body").animate({scrollTop:$("#report-results").offset().top-20},200))}))}return{init:function(){var idnumberTimer;if($("#categoryid").on("change",(function(){var categoryId=$(this).val();state.filter.category=categoryId,state.currentPage=0,$("#courseid").empty(),Str.get_string("option_all","block_report_customcajasan").then((function(allText){$("#courseid").append($("<option>",{value:"",text:allText}))})).catch((function(){$("#courseid").append($("<option>",{value:"",text:"All"}))})),categoryId?$.ajax({url:M.cfg.wwwroot+"/blocks/report_customcajasan/ajax/get_courses.php",type:"GET",data:{categoryid:categoryId,sesskey:M.cfg.sesskey},dataType:"json",success:function(data){data.success&&data.courses&&$.each(data.courses,(function(index,course){$("#courseid").append($("<option>",{value:course.id,text:course.fullname}))})),updateDownloadForm()},error:function(xhr,status){Notification.exception({message:"Error loading courses: "+status}),updateDownloadForm()}}):updateDownloadForm()})),$(".alphabet-filter a").on("click",(function(e){e.preventDefault();var letter=$(this).data("letter"),target=$(this).data("target");state.filter[target]=letter,$("#"+target).val(letter),$(this).closest(".alphabet-filter").find("a").removeClass("active"),$(this).addClass("active"),state.currentPage=0,loadReportData(),updateDownloadForm()})),$("#report-form").on("submit",(function(e){e.preventDefault(),state.currentPage=0,loadReportData(),updateDownloadForm()})),$("#estado, #courseid").on("change",(function(){var id=$(this).attr("id");state.filter[id]=$(this).val(),state.currentPage=0,updateDownloadForm()})),$("#startdate, #enddate").on("change",(function(){var id=$(this).attr("id");state.filter[id]=$(this).val(),state.currentPage=0,loadReportData(),updateDownloadForm()})),$("#idnumber").on("input",(function(){clearTimeout(idnumberTimer),idnumberTimer=setTimeout((function(){state.filter.idnumber=$("#idnumber").val(),state.currentPage=0,loadReportData(),updateDownloadForm()}),500)})),$("#perpage").on("change",(function(){var perpage=parseInt($(this).val());state.perPage=perpage,state.currentPage=0,loadReportData()})),$("#downloadForm").on("submit",(function(){return updateDownloadForm(),!!($('#downloadForm input[name="categoryid"]').val()||$('#downloadForm input[name="courseid"]').val()||$('#downloadForm input[name="estado"]').val()||$('#downloadForm input[name="idnumber"]').val()||$('#downloadForm input[name="firstname"]').val()||$('#downloadForm input[name="lastname"]').val()||$('#downloadForm input[name="startdate"]').val()||$('#downloadForm input[name="enddate"]').val())||(Notification.alert("",M.util.get_string("filters_required","block_report_customcajasan")),!1)})),$("#report-results").length){state.filter={category:$("#categoryid").val(),course:$("#courseid").val(),estado:$("#estado").val(),idnumber:$("#idnumber").val(),firstname:$("#firstname").val(),lastname:$("#lastname").val(),startdate:$("#startdate").val(),enddate:$("#enddate").val()},state.perPage=$("#perpage").val()?parseInt($("#perpage").val()):100;var hasSelectboxFilter=$("#categoryid").val()||$("#courseid").val()||$("#estado").val();$("#idnumber").val()||$("#firstname").val()||$("#lastname").val()||$("#startdate").val()||$("#enddate").val()?(loadReportData(),updateDownloadForm()):hasSelectboxFilter&&updateDownloadForm()}initializeDynamicElements()}}}));

//# sourceMappingURL=report.min.js.map